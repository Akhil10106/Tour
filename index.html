<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Status | Akhil's Masterpiece</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --lavender: #8e44ad;
            --rose-gold: #ff758c;
            --glass: rgba(255, 255, 255, 0.96);
        }

        body {
            margin: 0; min-height: 100vh; font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            overflow: hidden; display: flex; align-items: center; justify-content: center;
            user-select: none;
        }

        /* --- MAGIC CLICK PARTICLES --- */
        .click-heart {
            position: fixed; pointer-events: none; z-index: 10000;
            animation: heartFadeUp 1.5s ease-out forwards; font-size: 24px;
        }
        @keyframes heartFadeUp {
            0% { transform: translateY(0) scale(0.5) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-150px) scale(1.5) rotate(45deg); opacity: 0; }
        }

        /* --- OPTIMIZED COMPACT CARD --- */
        .proposal-card {
            background: var(--glass); backdrop-filter: blur(50px); border-radius: 40px;
            padding: 2.5rem 2rem; box-shadow: 0 40px 100px rgba(142, 68, 173, 0.15);
            max-width: 600px; width: 92%; text-align: center; border: 1px solid white;
            z-index: 10; position: relative; transition: all 0.4s ease;
        }

        .main-title { font-family: 'Dancing Script', cursive; font-size: 3rem; color: #2c3e50; line-height: 1.1; }
        .dest-highlight { color: var(--lavender); font-weight: 700; border-bottom: 2px dashed var(--lavender); }
        #instructionLabel { color: var(--rose-gold); font-weight: 700; min-height: 40px; margin-top: 10px; }

        /* --- BUTTONS --- */
        .btn-yes {
            background: linear-gradient(45deg, var(--lavender), var(--rose-gold));
            color: white !important; border: none; border-radius: 100px; padding: 15px 50px;
            font-weight: 700; font-size: 1.1rem; transition: transform 0.3s ease;
            box-shadow: 0 10px 25px rgba(142, 68, 173, 0.2); z-index: 20;
        }
        .btn-no {
            border-radius: 100px; padding: 12px 40px; font-weight: 600;
            border: 2px solid #ddd; background: #fff; color: #888;
            z-index: 15; cursor: default;
        }

        /* --- SIDEBAR --- */
        #adminSidebar {
            position: fixed; right: -400px; top: 0; width: 340px; height: 100vh;
            background: white; z-index: 5000; transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 2rem; box-shadow: -15px 0 50px rgba(0,0,0,0.08); overflow-y: auto;
        }
        #adminSidebar.active { right: 0; }

        .gear-btn {
            position: fixed; bottom: 25px; right: 25px; width: 55px; height: 55px;
            background: white; border-radius: 50%; display: none; align-items: center;
            justify-content: center; font-size: 1.5rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: none; z-index: 6000; color: var(--lavender);
        }

        /* --- COUNTDOWN BOXES --- */
        .countdown-container {
            display: flex; justify-content: center; gap: 12px; margin-top: 25px;
        }
        .time-box {
            background: rgba(142, 68, 173, 0.05); padding: 12px; border-radius: 15px;
            min-width: 70px; border: 1px solid rgba(142, 68, 173, 0.1);
        }
        .time-val { font-size: 1.5rem; font-weight: 700; color: var(--lavender); display: block; }
        .time-label { font-size: 0.65rem; text-transform: uppercase; color: #777; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div id="authScreen" class="animate__animated animate__fadeIn">
        <div class="proposal-card">
            <h1 class="main-title mb-4">Trip Dashboard</h1>
            <p class="text-muted mb-4">Unlock to view destination details.</p>
            <button id="loginBtn" class="btn btn-dark btn-lg rounded-pill px-5 shadow">Login with Google</button>
        </div>
    </div>

    <button id="gearBtn" class="gear-btn" onclick="toggleSidebar()"><i class="bi bi-gear-fill"></i></button>

    <div id="adminSidebar">
        <h5 class="fw-bold mb-4">Master Console</h5>
        <div class="mb-3">
            <label class="small fw-bold text-muted mb-1">FRIEND'S NAME</label>
            <input type="text" id="nameInput" class="form-control rounded-pill bg-light border-0 px-3 py-2 shadow-none">
        </div>
        <div class="mb-3">
            <label class="small fw-bold text-muted mb-1">DESTINATION</label>
            <input type="text" id="tripInput" class="form-control rounded-pill bg-light border-0 px-3 py-2 shadow-none">
        </div>
        <div class="mb-4">
            <label class="small fw-bold text-muted mb-1">DEPARTURE DATE</label>
            <input type="datetime-local" id="dateInput" class="form-control rounded-pill bg-light border-0 px-3 py-2 shadow-none">
        </div>
        <button class="btn btn-primary w-100 rounded-pill py-3 shadow mb-2" id="saveBtn">Apply Updates ‚ú®</button>
        <button class="btn btn-outline-danger w-100 rounded-pill py-2" onclick="auth.signOut().then(()=>location.reload())">Logout</button>
    </div>

    <div id="appUI" style="display:none; width:100%; height:100%; align-items:center; justify-content:center;">
        <div class="proposal-card animate__animated animate__zoomIn">
            <div id="proposalContent">
                <div id="emojiDisplay" class="display-1 mb-3">üèîÔ∏è</div>
                <h1 id="questionText" class="main-title">Heading to <span class="dest-highlight">Adventure</span></h1>
                <p id="instructionLabel" class="animate__animated"></p>
                
                <div class="d-flex justify-content-center flex-column flex-sm-row gap-3 mt-4" style="min-height: 80px;">
                    <button id="yesBtn" class="btn-yes shadow-lg">YES! üéí</button>
                    <button id="noBtn" class="btn-no shadow-sm">No üò¢</button>
                </div>
            </div>

            <div id="successContent" style="display:none;" class="animate__animated animate__fadeIn">
                <div class="display-1 mb-3">üï∫</div>
                <h1 class="main-title" style="color: var(--lavender);">Pack your bags!</h1>
                <h4 class="fw-bold mt-2">Thats like a good Son <span id="loggedInUserName"></span></h4>
                
                <div class="countdown-container">
                    <div class="time-box"><span class="time-val" id="days">00</span><span class="time-label">Days</span></div>
                    <div class="time-box"><span class="time-val" id="hours">00</span><span class="time-label">Hrs</span></div>
                    <div class="time-box"><span class="time-val" id="mins">00</span><span class="time-label">Mins</span></div>
                    <div class="time-box"><span class="time-val" id="secs">00</span><span class="time-label">Secs</span></div>
                </div>
                
                <p class="text-muted mt-3">Ready for departure ‚úàÔ∏è</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBatvEQWMtgwEd3rASMbNbkO46WGXJpEzI",
            authDomain: "home-9c9bb.firebaseapp.com",
            projectId: "home-9c9bb",
            storageBucket: "home-9c9bb.firebasestorage.app",
            messagingSenderId: "326102883938",
            appId: "1:326102883938:web:e2848f39a9f6fbc4557b3b"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const AKHIL_EMAIL = "akhilgoel985@gmail.com";
        let targetDate;
        let userDisplayName = "";

        function toggleSidebar() { document.getElementById('adminSidebar').classList.toggle('active'); }

        // --- MAGIC HEART CLICKS ---
        document.addEventListener('mousedown', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.closest('#adminSidebar')) return;
            const heart = document.createElement('div');
            heart.className = 'click-heart bi bi-heart-fill';
            heart.style.left = (e.clientX - 12) + 'px';
            heart.style.top = (e.clientY - 12) + 'px';
            heart.style.color = ['#8e44ad', '#ff758c', '#ffffff'][Math.floor(Math.random() * 3)];
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        });

        // --- AUTH ---
        document.getElementById('loginBtn').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        auth.onAuthStateChanged(user => {
            if (user) {
                userDisplayName = user.displayName;
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('appUI').style.display = 'flex';
                if (user.email === AKHIL_EMAIL) document.getElementById('gearBtn').style.display = 'flex';
                syncData();
            }
        });

        async function syncData() {
            const doc = await db.collection("proposal").doc("config").get();
            if (doc.exists) {
                const data = doc.data();
                if(data.destination) document.getElementById('questionText').innerHTML = `Heading to <span class="dest-highlight">${data.destination}</span>`;
                if(data.name) document.getElementById('nameInput').value = data.name;
                if(data.destination) document.getElementById('tripInput').value = data.destination;
                if(data.tripDate) {
                    targetDate = new Date(data.tripDate);
                    document.getElementById('dateInput').value = data.tripDate;
                }
            }
        }

        document.getElementById('saveBtn').onclick = async () => {
            const name = document.getElementById('nameInput').value;
            const destination = document.getElementById('tripInput').value;
            const tripDate = document.getElementById('dateInput').value;
            await db.collection("proposal").doc("config").set({ name, destination, tripDate }, { merge: true });
            location.reload();
        };

        // --- TRIP LOGIC ---
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const instruction = document.getElementById('instructionLabel');
        let hasClickedNo = false;
        
        const noClickPrompts = [
            "Wait! First click on No button",
            "Are you deaf? Click on the NO button first!",
            "Don't be so eager, click No first!",
            "Rules are rules, find the No button!",
            "Click No or the trip is cancelled!"
        ];
        let promptIndex = 0;

        yesBtn.onclick = () => {
            if (!hasClickedNo) {
                instruction.innerText = noClickPrompts[promptIndex % noClickPrompts.length];
                instruction.classList.remove('animate__shakeX');
                void instruction.offsetWidth; 
                instruction.classList.add('animate__shakeX');
                promptIndex++;
            } else {
                document.getElementById('proposalContent').style.display = 'none';
                document.getElementById('successContent').style.display = 'block';
                document.getElementById('loggedInUserName').innerText = userDisplayName || "";
                confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
                startCountdown();
            }
        };

        function teleportNo() {
            const yesRect = yesBtn.getBoundingClientRect();
            const padding = 150;
            let randomX, randomY;
            let isOverlapping = true;

            while (isOverlapping) {
                randomX = Math.random() * (window.innerWidth - noBtn.offsetWidth - 40) + 20;
                randomY = Math.random() * (window.innerHeight - noBtn.offsetHeight - 40) + 20;
                const overlapsYes = !(randomX + noBtn.offsetWidth < yesRect.left - padding || 
                                     randomX > yesRect.right + padding || 
                                     randomY + noBtn.offsetHeight < yesRect.top - padding || 
                                     randomY > yesRect.bottom + padding);

                if (!overlapsYes) isOverlapping = false;
            }

            noBtn.style.position = 'fixed';
            noBtn.style.left = randomX + 'px';
            noBtn.style.top = randomY + 'px';
        }

        noBtn.onclick = (e) => {
            e.preventDefault();
            hasClickedNo = true;
            instruction.innerText = "Why! When your DaD is coming then why you say No? Say Yes!";
            instruction.style.color = "#2ecc71"; 
            teleportNo(); 
        };

        noBtn.addEventListener('mouseenter', () => {
            if (hasClickedNo) teleportNo();
        });

        // --- COUNTDOWN LOGIC ---
        function startCountdown() {
            if(!targetDate) return;
            setInterval(() => {
                const now = new Date().getTime();
                const distance = targetDate - now;
                if (distance > 0) {
                    document.getElementById('days').innerText = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
                    document.getElementById('hours').innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
                    document.getElementById('mins').innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
                    document.getElementById('secs').innerText = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
                }
            }, 1000);
        }
    </script>
</body>
</html>
